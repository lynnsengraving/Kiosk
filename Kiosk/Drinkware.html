<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Drinkware - Lynn’s Engraving</title>

  <!-- IMPORTANT: GitHub Pages path -->
  <base href="/Kiosk/Kiosk/">

  <style>
    :root{
      --walnut:#5C4033;
      --cream:#FFF8E7;
      --dark:#111;
      --shadow:rgba(0,0,0,0.18);
    }

    body{
      margin:0;
      padding:20px;
      font-family: Arial, sans-serif;
      background:var(--cream);
      color:var(--dark);
      text-align:center;
    }

    header{
      font-size:32px;
      font-weight:800;
      margin:0 0 20px 0;
      color:var(--walnut);
    }

    .slideshow-container{
      width:520px;
      max-width:calc(100vw - 40px);
      position:relative;
      margin:0 auto 14px auto;
      border-radius:12px;
      overflow:hidden;
      background:#000;
      padding:10px;
      box-shadow:0 0 12px rgba(0,0,0,0.25);
      touch-action:pan-y;
    }

    .slide{ display:none; }

    .slide img{
      width:100%;
      height:320px;
      object-fit:cover;
      border-radius:8px;
      user-select:none;
      -webkit-user-drag:none;
      background:#000;
    }

    .nav-btn{
      cursor:pointer;
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      padding:12px 14px;
      color:#fff;
      background:rgba(0,0,0,0.45);
      font-size:30px;
      font-weight:900;
      border-radius:10px;
      user-select:none;
      border:none;
      outline:none;
    }
    .nav-btn:hover{ background:rgba(0,0,0,0.75); }
    .nav-prev{ left:10px; }
    .nav-next{ right:10px; }

    .dots{
      display:flex;
      justify-content:center;
      gap:8px;
      margin:10px 0 18px 0;
      flex-wrap:wrap;
    }

    .dot{
      width:12px;
      height:12px;
      border-radius:50%;
      background:rgba(0,0,0,0.25);
      cursor:pointer;
    }
    .dot.active{ background:var(--walnut); }

    form{
      background:#fff;
      padding:20px;
      max-width:520px;
      margin:0 auto;
      border-radius:10px;
      box-shadow:0 0 10px rgba(0,0,0,0.2);
      text-align:left;
    }

    form h2{
      margin:0 0 6px 0;
      color:var(--walnut);
      text-align:center;
    }

    form p{
      margin:0 0 14px 0;
      text-align:center;
    }

    label{
      font-weight:700;
      display:block;
      margin-top:12px;
    }

    input[type="text"],
    input[type="email"],
    input[type="file"],
    textarea{
      width:100%;
      padding:10px;
      margin-top:6px;
      border-radius:6px;
      border:1px solid #ccc;
      box-sizing:border-box;
    }

    textarea{ resize:vertical; min-height:120px; }

    .btn{
      width:100%;
      margin-top:15px;
      padding:12px;
      background:var(--walnut);
      color:var(--cream);
      border:none;
      border-radius:10px;
      font-size:16px;
      font-weight:800;
      cursor:pointer;
      transition:0.2s ease;
      box-shadow:0 4px 8px var(--shadow);
      display:block;
      text-align:center;
    }

    .btn:hover{
      background:var(--cream);
      color:var(--walnut);
      outline:2px solid var(--walnut);
    }

    .btn:disabled{
      opacity:0.6;
      cursor:not-allowed;
      outline:none;
    }

    .home-btn{
      max-width:520px;
      margin:14px auto 0 auto;
      text-align:center;
    }

    .btn-link{
      display:block;
      text-decoration:none;
    }

    #result{
      text-align:center;
      font-weight:800;
      margin-top:10px;
    }
  </style>
</head>

<body>

<header>Lynn’s Engraving Kiosk – Drinkware</header>

<div class="slideshow-container" id="slideshow">
  <div class="slide"><img src="Images/mb33.webp" alt="Drinkware 1"></div>
  <div class="slide"><img src="Images/mb34.jpeg" alt="Drinkware 2"></div>
  <div class="slide"><img src="Images/mb35.jpeg" alt="Drinkware 3"></div>
  <div class="slide"><img src="Images/mb36.jpeg" alt="Drinkware 4"></div>
  <div class="slide"><img src="Images/mb37.jpeg" alt="Drinkware 5"></div>
  <div class="slide"><img src="Images/mb38.webp" alt="Drinkware 6"></div>
  <div class="slide"><img src="Images/mb39.jpeg" alt="Drinkware 7"></div>
  <div class="slide"><img src="Images/mb40.webp" alt="Drinkware 8"></div>

  <button class="nav-btn nav-prev" type="button" aria-label="Previous" id="prevBtn">❮</button>
  <button class="nav-btn nav-next" type="button" aria-label="Next" id="nextBtn">❯</button>
</div>

<div class="dots" id="dotsWrap"></div>

<!-- AJAX submit so we can generate tracking + redirect correctly -->
<form id="orderForm" enctype="multipart/form-data">
  <input type="hidden" name="_subject" value="New Drinkware Order">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_template" value="table">
  <input type="hidden" name="_autoresponse" value="Thank you for your Drinkware order! We will contact you shortly.">
  <input type="hidden" name="tracking" id="trackingField" value="">

  <h2>Order Drinkware</h2>
  <p>Please fill out the form below.</p>

  <label>Your Name</label>
  <input type="text" name="name" autocomplete="name" required>

  <label>Your Email</label>
  <input type="email" name="email" autocomplete="email" required>

  <label>Engraving Text</label>
  <textarea name="engraving" required></textarea>

  <label>Upload Image or Logo (Optional)</label>
  <input type="file" name="attachment" accept="image/*">

  <label>Additional Notes</label>
  <textarea name="notes"></textarea>

  <button class="btn" id="submitBtn" type="submit">Submit Order</button>
  <div id="result"></div>
</form>

<div class="home-btn">
  <a class="btn-link" href="index.html"><span class="btn">Return Home</span></a>
</div>

<script>
(function () {
  // ===== Slideshow =====
  const slideshow = document.getElementById("slideshow");
  const dotsWrap = document.getElementById("dotsWrap");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");

  let slideIndex = 0;
  const intervalMs = 4000;
  let timer = null;

  function getSlides() { return Array.from(document.getElementsByClassName("slide")); }

  function wireImageErrors() {
    getSlides().forEach((slide) => {
      const img = slide.querySelector("img");
      if (!img) return;
      img.addEventListener("error", () => {
        slide.remove();
        const s = getSlides();
        if (!s.length) {
          dotsWrap.innerHTML = "";
          stopTimer();
          return;
        }
        slideIndex = Math.min(slideIndex, s.length - 1);
        buildDots();
        render();
      });
    });
  }

  function buildDots() {
    const slides = getSlides();
    dotsWrap.innerHTML = "";
    slides.forEach((_, i) => {
      const dot = document.createElement("span");
      dot.className = "dot";
      dot.addEventListener("click", () => goTo(i));
      dotsWrap.appendChild(dot);
    });
  }

  function render() {
    const slides = getSlides();
    const dots = Array.from(dotsWrap.getElementsByClassName("dot"));
    slides.forEach(s => s.style.display = "none");
    dots.forEach(d => d.classList.remove("active"));
    if (!slides.length) return;
    slides[slideIndex].style.display = "block";
    if (dots[slideIndex]) dots[slideIndex].classList.add("active");
  }

  function goTo(i) {
    const slides = getSlides();
    if (!slides.length) return;
    slideIndex = (i + slides.length) % slides.length;
    render();
    resetTimer();
  }

  function next(){ goTo(slideIndex + 1); }
  function prev(){ goTo(slideIndex - 1); }

  function stopTimer(){
    if (timer) clearInterval(timer);
    timer = null;
  }

  function resetTimer() {
    stopTimer();
    timer = setInterval(next, intervalMs);
  }

  prevBtn.addEventListener("click", prev);
  nextBtn.addEventListener("click", next);

  // Pause on hover
  slideshow.addEventListener("mouseenter", stopTimer);
  slideshow.addEventListener("mouseleave", resetTimer);

  // Swipe
  let startX = 0;
  slideshow.addEventListener("touchstart", (e) => { startX = e.touches[0].clientX; }, { passive: true });
  slideshow.addEventListener("touchend", (e) => {
    const dx = e.changedTouches[0].clientX - startX;
    if (Math.abs(dx) > 40) (dx > 0 ? prev() : next());
  }, { passive: true });

  // Keyboard
  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") prev();
    if (e.key === "ArrowRight") next();
  });

  wireImageErrors();
  buildDots();
  render();
  resetTimer();

  // ===== FormSubmit via AJAX (lets us generate tracking + redirect) =====
  const form = document.getElementById("orderForm");
  const submitBtn = document.getElementById("submitBtn");
  const result = document.getElementById("result");
  let submitted = false;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (submitted) return;

    const tracking = "DW-" + Math.floor(100000 + Math.random() * 900000);
    document.getElementById("trackingField").value = tracking;

    submitted = true;
    submitBtn.disabled = true;
    submitBtn.textContent = "Sending…";
    result.textContent = "Please wait…";

    try {
      const formData = new FormData(form);

      const res = await fetch("https://formsubmit.co/ajax/lynnsengraving24@gmail.com", {
        method: "POST",
        headers: { "Accept": "application/json" },
        body: formData
      });

      const data = await res.json();

      if (res.ok) {
        alert("Your order has been submitted!\nTracking Number: " + tracking);
        result.textContent = "✅ Sent! Redirecting to tracking…";

        // Change tracking page filename here if yours is different
        setTimeout(() => {
          window.location.href = `tracking.html?code=${encodeURIComponent(tracking)}`;
        }, 900);

      } else {
        result.textContent = "❌ Not sent: " + (data.message || "Unknown error");
        submitted = false;
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit Order";
      }
    } catch (err) {
      result.textContent = "❌ Not sent: Network/blocked request.";
      submitted = false;
      submitBtn.disabled = false;
      submitBtn.textContent = "Submit Order";
    }
  });
})();
</script>

</body>
</html>
